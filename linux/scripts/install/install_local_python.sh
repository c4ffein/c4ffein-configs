#!/bin/bash


NAME="Python"
VERSION="3.9.9"
NO_PATCH_VERSION="3.9"
NAME_AND_VERSION="${NAME}-${VERSION}"
TARBALL_LINK="https://www.python.org/ftp/python/${VERSION}/${NAME_AND_VERSION}.tar.xz"
TARBALL_ASC_LINK="${TARBALL_LINK}.asc"
TARBALL_NAME="${NAME_AND_VERSION}.tar.xz"
LOCAL_STUFF="${HOME}/.local/external/python/"
DL_STUFF="${HOME}/.local/external/python/source_releases/${VERSION}"
BUILD_STUFF="${HOME}/.local/external/python/build/${VERSION}"
LOCAL_BIN="${HOME}/.local/bin/"


mkdir -p "$LOCAL_STUFF"
mkdir -p "$DL_STUFF"

gpg --no-default-keyring --keyring "${DL_STUFF}/keyring.gpg" --import <<'endmsg'
-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=UGoM
-----END PGP PUBLIC KEY BLOCK-----
endmsg

wget "$TARBALL_LINK" -O "${DL_STUFF}/${TARBALL_NAME}"
wget "$TARBALL_ASC_LINK" -O "${DL_STUFF}/${TARBALL_NAME}.asc"
gpg --verify "${DL_STUFF}/${TARBALL_NAME}.asc"
if [ $? -ne 0 ]; then
    echo -e "\e[31m"GPG Error. Check archive key."\e[0m"
    exit
fi
mkdir -p "${DL_STUFF}/archive"
tar x -C "${DL_STUFF}/archive" -f "${DL_STUFF}/${TARBALL_NAME}"
cd "${DL_STUFF}/archive/${NAME_AND_VERSION}"
./configure --enable-optimizations
make -j $nproc
mkdir -p "${LOCAL_STUFF}/build/${VERSION}"
make altinstall prefix="${BUILD_STUFF}"

mkdir -p "${LOCAL_BIN}"
ln -s "${BUILD_STUFF}/bin/python${NO_PATCH_VERSION}" "${LOCAL_BIN}/python"
ln -s "${BUILD_STUFF}/bin/python${NO_PATCH_VERSION}" "${LOCAL_BIN}/python${NO_PATCH_VERSION}"
